<!DOCTYPE html>
<html lang="bs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KVIZ 1D - NIVO 1</title>
    
    <!-- Centralizovani CSS -->
    <link rel="stylesheet" href="../core/styles.css">
</head>
<body>
    <div class="container">
        <!-- HEADER -->
        <div class="quiz-header">
            <img src="../assets/images/mekteb_logo.png" alt="MEKTEB Logo" class="quiz-icon">
            <h1>KVIZ 1D</h1>
            <p class="subtitle">Nivo 1 - ƒåetvrti kviz</p>
        </div>

        <!-- QUIZ SCREEN -->
        <div id="quizScreen" class="quiz-screen">
            <div class="progress-info">
                <a href="../index.html" class="back-link">‚Üê Nazad</a>
                <div class="progress-bar-container">
                    <div id="progressBar" class="progress-bar"></div>
                </div>
                <span id="questionCounter" style="color: #fbbf24; font-weight: 600;">1/20</span>
            </div>

            <div class="question-card">
                <div id="questionText" class="question-text"></div>
                <div id="optionsContainer" class="options"></div>
            </div>
        </div>

        <!-- RESULT SCREEN -->
        <div id="resultScreen" class="result-screen">
            <div class="result-card">
                <div id="resultEmoji" class="result-emoji">üåü</div>
                <div id="resultMessage" class="result-message">Izvrsno!</div>
                <div id="resultScore" class="result-score">0/20</div>
                <div id="resultPercentage" class="result-percentage">0% taƒçnih odgovora</div>
                <button onclick="restartQuiz()" class="restart-btn">üîÑ Ponovi kviz</button>
            </div>
        </div>
    </div>

    <!-- POPUP OVERLAY -->
    <div id="popupOverlay" class="popup-overlay">
        <div class="popup-content">
            <div id="popupIcon" class="popup-icon">‚úÖ</div>
            <div id="popupTitle" class="popup-title">Taƒçno!</div>
            <div id="popupExplanation" class="popup-explanation"></div>
            <button onclick="nextQuestion()" class="popup-next-btn">Sljedeƒáe pitanje ‚Üí</button>
        </div>
    </div>

    <!-- QUIZ DATA - Ovdje ide samo baza pitanja -->
    <script>
        const quizData = {
            questionsToShow: 20,
            allQuestions: [
                {
                    question: "Ko je stvorio svijet?",
                    options: ["Allah", "Priroda", "Ljudi", "Niko"],
                    answer: "Allah",
                    explanation: "Allah je jedini Stvoritelj svega ≈°to postoji - neba, zemlje i svega izmeƒëu njih."
                },
                {
                    question: "Koliko ima poslanika ƒçija imena treba znati?",
                    options: ["25", "10", "50", "100"],
                    answer: "25",
                    explanation: "Muslimani moraju znati imena 25 poslanika koji su spomenuti u Kur'anu."
                },
                {
                    question: "Koji je prvi stup islama?",
                    options: ["Kelime-i ≈°ehadet", "Namaz", "Post", "Zekat"],
                    answer: "Kelime-i ≈°ehadet",
                    explanation: "Prvi stup islama je kelime-i ≈°ehadet - svjedoƒçenje da nema drugog boga osim Allaha i da je Muhammed Njegov poslanik."
                },
                {
                    question: "Koliko puta dnevno musliman klanja namaz?",
                    options: ["5 puta", "3 puta", "7 puta", "4 puta"],
                    answer: "5 puta",
                    explanation: "Muslimani klanjaju pet dnevnih namaza: sabah, podne, ikindija, ak≈°am i jacija."
                },
                {
                    question: "U kojem mjesecu se posti?",
                    options: ["Ramazan", "Muharrem", "Red≈æeb", "≈†evval"],
                    answer: "Ramazan",
                    explanation: "Post se dr≈æi u ramazanu, devetom mjesecu islamskog kalendara."
                },
                {
                    question: "Koliko je poslanika poslano ljudima?",
                    options: ["124.000", "1.000", "25", "313"],
                    answer: "124.000",
                    explanation: "Allah je poslao 124.000 poslanika, ali moramo znati imena 25 koji su spominjani u Kur'anu."
                },
                {
                    question: "Koji je posljednji Allah's poslanik?",
                    options: ["Muhammed a.s.", "Isa a.s.", "Musa a.s.", "Ibrahim a.s."],
                    answer: "Muhammed a.s.",
                    explanation: "Muhammed, a.s., je posljednji Allahov poslanik poslan svim ljudima."
                },
                {
                    question: "Kako se zove sveta knjiga muslimana?",
                    options: ["Kur'an", "Tevrat", "Zebur", "Ind≈æil"],
                    answer: "Kur'an",
                    explanation: "Kur'an je posljednja Allahova knjiga, objavljena Muhammedu, a.s."
                },
                {
                    question: "Gdje se muslimani okupe petkom na d≈æumu?",
                    options: ["U d≈æamiji", "U kuƒái", "Na ulici", "U ≈°koli"],
                    answer: "U d≈æamiji",
                    explanation: "Petkom se muslimani okupljaju u d≈æamiji na d≈æuma-namaz."
                },
                {
                    question: "Koliko stubova ima islam?",
                    options: ["5", "3", "7", "6"],
                    answer: "5",
                    explanation: "Islam ima pet stubova: kelime-i ≈°ehadet, namaz, zekat, post i had≈æd≈æ."
                },
                {
                    question: "Koji meleki su ƒçuvari d≈æennetskih vrata?",
                    options: ["Ridvan", "Malik", "Munker i Nekir", "Kiramen-Katibin"],
                    answer: "Ridvan",
                    explanation: "Ridvan je melek ƒçuvar d≈æennetskih vrata."
                },
                {
                    question: "Kako se zovu meleki koji pitaju u kaburu?",
                    options: ["Munker i Nekir", "Ridvan i Malik", "D≈æebrail i Mikail", "Israfil i Azrail"],
                    answer: "Munker i Nekir",
                    explanation: "Munker i Nekir su meleki koji pitaju ƒçovjeka u kaburu o njegovoj vjeri."
                },
                {
                    question: "Ko je prvi meleku koji je stvoren?",
                    options: ["D≈æebrail a.s.", "Mikail a.s.", "Israfil a.s.", "Azrail a.s."],
                    answer: "D≈æebrail a.s.",
                    explanation: "D≈æebrail je prvi stvoreni melek i nosio je objave poslanicima."
                },
                {
                    question: "Koji su meleki zadu≈æeni za zapisivanje dobrih i lo≈°ih djela?",
                    options: ["Kiramen-Katibin", "Munker i Nekir", "Ridvan i Malik", "Harun i Marut"],
                    answer: "Kiramen-Katibin",
                    explanation: "Kiramen-Katibin (plemeniti pisari) su meleki koji zapisuju na≈°a djela."
                },
                {
                    question: "≈†ta znaƒçi rijeƒç 'Islam'?",
                    options: ["Pokornost Allahu", "Vjerovanje", "Milosrƒëe", "Mir"],
                    answer: "Pokornost Allahu",
                    explanation: "Islam znaƒçi potpuna predanost i pokornost Allahu."
                },
                {
                    question: "Koliko je dana ramazana?",
                    options: ["29 ili 30", "28", "31", "15"],
                    answer: "29 ili 30",
                    explanation: "Ramazan traje 29 ili 30 dana, ovisno o pojavi mladog mjeseca."
                },
                {
                    question: "Koja je prva objava meleka D≈æebraila Muhammedu a.s.?",
                    options: ["Ikra (Uƒçi)", "Bismillah", "El-hamdu lillah", "La ilahe illallah"],
                    answer: "Ikra (Uƒçi)",
                    explanation: "Prva objava bila je rijeƒç 'Ikra' (Uƒçi) u peƒáini Hira."
                },
                {
                    question: "≈†ta znaƒçi rijeƒç 'Allah'?",
                    options: ["Bog, Stvoritelj svega", "Kralj", "Moƒáan", "Veliki"],
                    answer: "Bog, Stvoritelj svega",
                    explanation: "Allah znaƒçi Jedini Bog, Stvoritelj svega ≈°to postoji."
                },
                {
                    question: "Koliko puta se spominje 'bismillah' u Kur'anu?",
                    options: ["114 puta", "99 puta", "313 puta", "1 put"],
                    answer: "114 puta",
                    explanation: "Bismillah se spominje 114 puta u Kur'anu - na poƒçetku svake sure osim jedne."
                },
                {
                    question: "≈†ta je Mirad≈æ?",
                    options: ["Noƒáno putovanje i uznesenje", "Roƒëenje Muhammeda a.s.", "Prva objava", "Preseljenje u Medinu"],
                    answer: "Noƒáno putovanje i uznesenje",
                    explanation: "Mirad≈æ je noƒáno putovanje Muhammeda, a.s., iz Mekke u Jerusalim i uznesenje na nebesa."
                },
                {
                    question: "Kako se zove preseljenje iz Mekke u Medinu?",
                    options: ["Hid≈æra", "Mirad≈æ", "Kurban", "Had≈æd≈æ"],
                    answer: "Hid≈æra",
                    explanation: "Hid≈æra je preseljenje Muhammeda, a.s., i muslimana iz Mekke u Medinu 622. godine."
                },
                {
                    question: "Koja sura se prvo uƒçi?",
                    options: ["El-Fatiha", "El-Ihlas", "En-Nas", "El-Felak"],
                    answer: "El-Fatiha",
                    explanation: "El-Fatiha je prva sura koja se uƒçi i mora se znati za namaz."
                },
                {
                    question: "Koliko ajeta ima sura El-Fatiha?",
                    options: ["7", "5", "10", "3"],
                    answer: "7",
                    explanation: "Sura El-Fatiha ima 7 ajeta."
                },
                {
                    question: "≈†ta znaƒçi 'kelime-i ≈°ehadet'?",
                    options: ["Svjedoƒçenje vjere", "Namaz", "Post", "Dova"],
                    answer: "Svjedoƒçenje vjere",
                    explanation: "Kelime-i ≈°ehadet je svjedoƒçenje da nema drugog boga osim Allaha i da je Muhammed Njegov poslanik."
                },
                {
                    question: "Kada se slavi Ramazanski bajram?",
                    options: ["1. ≈°evvala", "10. zul-hid≈æd≈æeta", "12. rebiul-evvela", "1. ramazana"],
                    answer: "1. ≈°evvala",
                    explanation: "Ramazanski bajram pada 1. ≈°evvala, prvog dana nakon ramazana."
                },
                {
                    question: "Kada se slavi Kurban-bajram?",
                    options: ["10. zul-hid≈æd≈æeta", "1. ≈°evvala", "27. ramazana", "12. rebiul-evvela"],
                    answer: "10. zul-hid≈æd≈æeta",
                    explanation: "Kurban-bajram pada 10. zul-hid≈æd≈æeta, zadnjeg mjeseca islamskog kalendara."
                },
                {
                    question: "Koliko rekata ima sabah-namaz?",
                    options: ["4 (2 sunnet + 2 farz)", "2", "3", "5"],
                    answer: "4 (2 sunnet + 2 farz)",
                    explanation: "Sabah-namaz ima ukupno 4 rekata: 2 sunnet i 2 farz."
                },
                {
                    question: "GRE≈†KA U REƒåENICI: 'Muslimani vjeruju u jednog Boga, vi≈°e meleka i 25 poslanika.'",
                    options: ["'vi≈°e meleka' treba biti 'mnogo meleka' ili samo 'meleke'", "Sve je taƒçno", "'25 poslanika' treba biti '124.000'", "'jednog Boga' treba biti 'tri boga'"],
                    answer: "'vi≈°e meleka' treba biti 'mnogo meleka' ili samo 'meleke'",
                    explanation: "Muslimani vjeruju u mnogo meleka (taƒçan broj ne znamo), ali znamo imena nekih od njih. 25 je broj poslanika ƒçija imena moramo znati."
                },
                {
                    question: "GRE≈†KA U REƒåENICI: 'Kur'an je objavljen Ademuu a.s. u peƒáini Hira.'",
                    options: ["'Ademu a.s.' treba biti 'Muhammedu a.s.'", "Sve je taƒçno", "'peƒáini Hira' treba biti 'Mekki'", "'Kur'an' treba biti 'Tevrat'"],
                    answer: "'Ademu a.s.' treba biti 'Muhammedu a.s.'",
                    explanation: "Kur'an je objavljen Muhammedu, a.s., u peƒáini Hira. Adem, a.s., je bio prvi ƒçovjek i poslanik, ali njemu nije objavljen Kur'an."
                },
                {
                    question: "GRE≈†KA U REƒåENICI: 'Islam ima ≈°est stubova: ≈°ehadet, namaz, zekat, had≈æd≈æ, post i iman.'",
                    options: ["'≈°est' treba biti 'pet' (iman nije stup islama)", "Sve je taƒçno", "'namaz' treba biti 'dova'", "'had≈æd≈æ' treba biti 'kurban'"],
                    answer: "'≈°est' treba biti 'pet' (iman nije stup islama)",
                    explanation: "Islam ima pet stubova. Iman (vjera) nije stup islama, nego je osnova. Pet stubova su: ≈°ehadet, namaz, zekat, post i had≈æd≈æ."
                },
                {
                    question: "ASOCIJACIJA: Rijeƒç '≈°evval' vas asocira na:",
                    options: ["Ramazanski bajram", "Kurban-bajram", "Post", "Mevlud"],
                    answer: "Ramazanski bajram",
                    explanation: "Ramazanski bajram pada 1. ≈°evvala, prvog dana mjeseca ≈°evvala nakon ramazana."
                },
                {
                    question: "ASOCIJACIJA: Broj '622' vas asocira na:",
                    options: ["Godinu Hid≈ære", "Roƒëenje Muhammeda, a.s.", "Broj ajeta u Kur'anu", "Broj poslanika"],
                    answer: "Godinu Hid≈ære",
                    explanation: "622. godina je godina Hid≈ære - preseljenja Muhammeda, a.s., iz Mekke u Medinu. Od nje poƒçinje islamski kalendar."
                },
                {
                    question: "ANALOGIJA: Ramazanski bajram : 1. ≈°evval = Kurban-bajram : ?",
                    options: ["10. zul-hid≈æd≈æe", "1. muharrem", "12. rebiul-evvel", "27. red≈æeb"],
                    answer: "10. zul-hid≈æd≈æe",
                    explanation: "Kao ≈°to Ramazanski bajram pada 1. ≈°evvala, tako Kurban-bajram pada 10. zul-hid≈æd≈æeta."
                },
                {
                    question: "ANALOGIJA: Sabah : 4 rekata = Ak≈°am : ?",
                    options: ["5 rekata", "3 rekata", "4 rekata", "6 rekata"],
                    answer: "5 rekata",
                    explanation: "Sabah-namaz ima 4 rekata (2 sunnet + 2 farz), a ak≈°am-namaz ima 5 rekata (3 farz + 2 sunnet)."
                },
                {
                    question: "ANALOGIJA: Mekka : Hid≈æra = Medina : ?",
                    options: ["Odredi≈°te", "Polazi≈°te", "Rodno mjesto", "Kibla"],
                    answer: "Odredi≈°te",
                    explanation: "Kao ≈°to je Mekka bila polazi≈°te Hid≈ære, tako je Medina bila odredi≈°te - grad u koji se preselio Muhammed, a.s."
                },
                {
                    question: "KO SAM JA? Ja sam dova koja se uƒçi na sjedenju u namazu. Potjeƒçem od razgovora na Mirad≈æu. Sadr≈æim pozdrave Allahu.",
                    options: ["Et-Tehijatu", "Subhaneke", "Salavati", "Kunut-dova"],
                    answer: "Et-Tehijatu",
                    explanation: "Et-Tehijatu je dova na sjedenju u namazu, sadr≈æi pozdrave Allahu i potjeƒçe od razgovora Muhammeda, a.s., s Allahom na Mirad≈æu."
                },
                {
                    question: "≈†TA SAM JA? Ja sam mjesec posta. Deveti sam mjesec hid≈æretskog kalendara. U meni je objavljen Kur'an.",
                    options: ["Ramazan", "Muharrem", "≈†evval", "Zul-hid≈æd≈æe"],
                    answer: "Ramazan",
                    explanation: "Ramazan je deveti mjesec islamskog kalendara, mjesec posta u kojem je poƒçela objava Kur'ana."
                },
                {
                    question: "KO SAM JA? Ja sam namaz koji se klanja samo u ramazanu. Klanjam se poslije jacije. Imam 20 rekata.",
                    options: ["Teravih-namaz", "D≈æuma-namaz", "Bajram-namaz", "D≈æenaza-namaz"],
                    answer: "Teravih-namaz",
                    explanation: "Teravih je namaz koji se klanja samo u ramazanu, poslije jacija-namaza, i ima 20 rekata."
                },
                {
                    question: "≈†TA SAM JA? Ja sam ƒçestitka za bajram. Izgovaram se prilikom ƒçestitanja. Znaƒçim 'Neka vam je bajram blagoslovljen'.",
                    options: ["Bajram ≈°erif mubarek olsun", "Es-selamu alejkum", "El-hamdu lillah", "Ma≈°allah"],
                    answer: "Bajram ≈°erif mubarek olsun",
                    explanation: "Bajram ≈°erif mubarek olsun je tradicionalna bajramska ƒçestitka koja znaƒçi 'Neka vam je bajram blagoslovljen'."
                },
                {
                    question: "DOPUNI NIZ: Muharrem, safer, rebiul-evvel, rebiul-ahir, ...?",
                    options: ["D≈æumadel-ula", "Ramazan", "≈†evval", "Zul-hid≈æd≈æe"],
                    answer: "D≈æumadel-ula",
                    explanation: "Redoslijed prvih mjeseci islamskog kalendara: Muharrem, safer, rebiul-evvel, rebiul-ahir, d≈æumadel-ula..."
                },
                {
                    question: "DOPUNI NIZ: Farz sabaha, sunnet sabaha, farz podne, ...?",
                    options: ["Sunnet podne", "Farz ikindije", "Sunnet ikindije", "Prvi sunnet podne"],
                    answer: "Sunnet podne",
                    explanation: "U sabahu prvo klanjamo sunnet pa farz, a u podne prvo farz pa sunnet (ima i sunnet prije farza)."
                },
                {
                    question: "SITUACIJA: Sutra je bajram. ≈†ta treba prouƒçiti ujutro prije bajram-namaza?",
                    options: ["Tekbire", "Salavate", "Et-Tehijatu", "Kunut-dovu"],
                    answer: "Tekbire",
                    explanation: "Uoƒçi i na dan bajrama uƒçe se tekbiri - veliƒçanje Allaha rijeƒçima 'Allahu ekber'."
                },
                {
                    question: "SITUACIJA: Ai≈°a je pogrije≈°ila i ≈æeli zatra≈æiti Allahov oprost. Koje rijeƒçi treba izgovoriti?",
                    options: ["Estagfirullah", "In≈°allah", "Ma≈°allah", "Subhanallah"],
                    answer: "Estagfirullah",
                    explanation: "Estagfirullah (Tra≈æim Allahov oprost) ka≈æemo kada se kajemo za grijehe i tra≈æimo Allahov oprost."
                },
                {
                    question: "SITUACIJA: Bilal je zavr≈°io uƒçenje Kur'ana. Koje rijeƒçi treba izgovoriti?",
                    options: ["Sadekallahul-'azim", "Bismillah", "In≈°allah", "Estagfirullah"],
                    answer: "Sadekallahul-'azim",
                    explanation: "Sadekallahul-'azim (Istinu je rekao Uzvi≈°eni Allah) ka≈æemo nakon uƒçenja Kur'ana."
                }
            ]
        };
    </script>

    <!-- Centralizovani JavaScript Engine -->
    <script src="../core/quiz-engine.js"></script>
    <!-- MEKTEB AUTO-SAVE - Inline integracija -->
    <script>
    console.log('üîå MEKTEB AUTO-SAVE: Uƒçitan!');
    
    // ƒåekaj da se stranica potpuno uƒçita
    window.addEventListener('load', function() {
        console.log('üìÑ Stranica uƒçitana, aktiviram auto-save...');
        
        // Funkcija za spremanje rezultata
        async function saveMektebResult(score, total, time) {
            const API_URL = 'https://mekteb.net/wp-json/mekteb/v1';
            
            console.log('üíæ saveMektebResult pozvan:', {score, total, time});
            
            // Provjeri da li je korisnik prijavljen
            const userData = localStorage.getItem('mektebUser');
            if (!userData) {
                console.log('‚ö†Ô∏è Korisnik nije prijavljen - preskaƒçem spremanje');
                return false;
            }
            
            let user;
            try {
                user = JSON.parse(userData);
                console.log('üë§ Prijavljen korisnik:', user.name, '(ID:', user.id + ')');
            } catch (e) {
                console.error('‚ùå Gre≈°ka pri parsiranju user podataka:', e);
                return false;
            }
            
            // Detektuj naziv kviza iz URL-a
            const quizName = window.location.pathname.match(/\/([^\/]+)\.html$/)?.[1]?.toUpperCase() || 'UNKNOWN';
            console.log('üìù Kviz:', quizName);
            
            const payload = {
                user_id: user.id,
                quiz: quizName,
                score: score,
                total: total,
                time: time || 0
            };
            
            console.log('üì§ ≈†aljem na API:', payload);
            
            try {
                const response = await fetch(API_URL + '/save', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                
                console.log('üì• API Response Status:', response.status);
                
                const data = await response.json();
                console.log('üì¶ API Response Data:', data);
                
                if (data.success) {
                    console.log('‚úÖ REZULTAT USPJE≈†NO SPREMLJEN!');
                    console.log('   User:', user.name);
                    console.log('   Kviz:', quizName);
                    console.log('   Rezultat:', score + '/' + total);
                    console.log('   Postotak:', Math.round((score/total)*100) + '%');
                    return true;
                } else {
                    console.error('‚ùå API vratio gre≈°ku:', data.message);
                    return false;
                }
            } catch (error) {
                console.error('üî• Gre≈°ka pri slanju na API:', error);
                return false;
            }
        }
        
        // Javna funkcija za ruƒçno spremanje
        window.mektebSave = saveMektebResult;
        
        // AUTOMATSKO DETEKTOVANJE REZULTATA
        let resultSaved = false;
        let lastSeenScore = '0/20';
        
        const observer = new MutationObserver(function(mutations) {
            const resultScreen = document.getElementById('resultScreen');
            const resultScore = document.getElementById('resultScore');
            
            if (resultScreen && resultScore && 
                resultScreen.style.display !== 'none' && 
                !resultSaved) {
                
                const scoreText = resultScore.textContent;
                
                // Ako se rezultat promijenio i nije 0/20
                if (scoreText !== lastSeenScore && scoreText !== '0/20') {
                    console.log('üéØ Rezultat se promijenio:', lastSeenScore, '‚Üí', scoreText);
                    
                    const match = scoreText.match(/(\d+)\/(\d+)/);
                    if (match) {
                        const score = parseInt(match[1]);
                        const total = parseInt(match[2]);
                        
                        // Validacija: score mora biti > 0 ili ako je stvarno 0 onda total > 0
                        if (score > 0 || (score === 0 && total > 0 && scoreText !== '0/20')) {
                            console.log('‚úÖ Detektovan finalni rezultat:', score + '/' + total);
                            
                            resultSaved = true;
                            saveMektebResult(score, total, 0);
                        }
                    }
                }
                
                lastSeenScore = scoreText;
            }
        });
        
        // Posmatraj cijeli body
        observer.observe(document.body, {
            childList: true,
            subtree: true,
            attributes: true,
            attributeFilter: ['style'],
            characterData: true  // Prati promjene u tekstualnom sadr≈æaju
        });
        
        console.log('‚úÖ Auto-save modul aktivan!');
        console.log('   üìå Za ruƒçno spremanje: window.mektebSave(score, total, time)');
    });
    </script>
</body>
</html>
